<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Plugins</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Apisearch plugins.">
    <meta name="author" content="Apisearch team">
    <meta name="keywords" content="Apisearch, Elasticsearch search engine, fast search demo, Apisearch official website">

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="57x57" href="https://raw.githubusercontent.com/apisearch-io/apisearch.io/master/assets/favicons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="https://raw.githubusercontent.com/apisearch-io/apisearch.io/master/assets/favicons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://raw.githubusercontent.com/apisearch-io/apisearch.io/master/assets/favicons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://raw.githubusercontent.com/apisearch-io/apisearch.io/master/assets/favicons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://raw.githubusercontent.com/apisearch-io/apisearch.io/master/assets/favicons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://raw.githubusercontent.com/apisearch-io/apisearch.io/master/assets/favicons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://raw.githubusercontent.com/apisearch-io/apisearch.io/master/assets/favicons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://raw.githubusercontent.com/apisearch-io/apisearch.io/master/assets/favicons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/apisearch-io/apisearch.io/master/assets/favicons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="https://raw.githubusercontent.com/apisearch-io/apisearch.io/master/assets/favicons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://raw.githubusercontent.com/apisearch-io/apisearch.io/master/assets/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="https://raw.githubusercontent.com/apisearch-io/apisearch.io/master/assets/favicons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://raw.githubusercontent.com/apisearch-io/apisearch.io/master/assets/favicons/favicon-16x16.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="https://raw.githubusercontent.com/apisearch-io/apisearch.io/master/assets/favicons/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <!-- Styles -->
    <link rel="stylesheet" href="./assets/css/docs.css">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
          rel="stylesheet"
          integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN"
          crossorigin="anonymous"
    >

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-110185459-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-110185459-2');
    </script>
</head>
<body>
    <!-- Header -->
    <header>
        <nav class="c-navbar navbar navbar-expand-md fixed-top">
            <div class="c-navbar__main row">
                <!-- Brand -->
                <div class="c-navbar__brandWrapper col-2 col-sm-4 col-md-3 col-lg-2">
                    <a class="c-navbar__brand navbar-brand" href="/">
                        <img
                            class="d-block d-sm-none"
                            width="32px"
                            src="//apisearch.io/assets/media/apisearch-logo.svg"
                            alt="Mobile aspisearch logo"
                        >
                        <img src="https://raw.githubusercontent.com/apisearch-io/apisearch.io/master/assets/media/apisearch-long-logo.png"
                             class="d-none d-sm-inline-block"
                             height="15"
                             alt="Logo Apisearch">
                    </a>
                </div>
                <!-- /Brand -->

                <!-- Search -->
                <div class="c-search col-8 col-sm-8 col-md-9 col-lg-10 ml-md-auto">
                    <i class="c-search__searchIcon fa fa-search"
                       aria-hidden="true"></i>

                    <!-- Apisearch target -->
                    <div class="c-search__wrapper" id="searchInput"></div>
                </div>
                <!-- /Search -->

                <!-- Menu burger -->
                <div class="col-2 d-sm-none">
                    <button class="c-navbar__burger navbar-toggler">
                        <svg xmlns="http://www.w3.org/2000/svg"
                             id="burgerSidebarMenu"
                             viewBox="0 0 30 30"
                             width="30"
                             height="30"
                             focusable="false"
                        >
                            <title>Menu</title>
                            <path stroke="#54edc0"
                                  stroke-width="2"
                                  stroke-linecap="round"
                                  stroke-miterlimit="10"
                                  d="M4 7h22M4 15h22M4 23h22"
                            ></path>
                        </svg>
                    </button>
                </div>
                <!-- /Menu burger -->
            </div>
        </nav>

        <!-- submenu -->
        <div class="c-navbar__bottom">
            <div class="row">
                <div class="d-none d-sm-block col-sm-6">
                    <!-- submenu -->
                    <nav class="c-breadcrumb" aria-label="breadcrumb" role="navigation">
                        <ol class="c-breadcrumb__list breadcrumb">
                            <li class="c-breadcrumb__item breadcrumb-item">
                                <a href="/">Apisearch docs</a>
                            </li>
                                <li class="c-breadcrumb__item breadcrumb-item">
                                    <a href="#">Plugins</a>
                                </li>
                            <li class="c-breadcrumb__item--active breadcrumb-item active" aria-current="page">
                                Plugins
                            </li>
                        </ol>
                    </nav>
                    <!-- /submenu -->
                </div>
                <div class="col-12 col-sm-6">
                    <!-- language selector -->
                    <nav class="c-languageSelector">
                        <ol class="c-languageSelector__list">
                        </ol>
                    </nav>
                    <!-- /language selector -->
                </div>
            </div>
        </div>
        <!-- /submenu -->
    </header>    <!-- /Header -->

    <!-- Search result -->
    <div id="searchResult" class="c-search__result d-none">

        <!-- Result container -->
        <div class="c-search__resultBlock container-fluid">
            <div class="row">
                <!-- Content -->
                <div class="col-sm-12">
                    <div id="topicsSearchResult"></div>
                </div>
            </div>
        </div>

        <!-- Pagination
        <div id="paginationSearch"></div>
        -->
    </div>    <!-- /Search result -->

    <!-- Main -->
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div id="sidebarMenu"
                 class="c-sidebar sidebar col-sm-4 col-md-3 col-lg-2 d-none d-sm-block"
            >
                <ul class="c-sidebar__nav nav nav-pills flex-column">
                        <li class="c-sidebar__navItem nav-item">
                            <a class="c-sidebar__navLink c-sidebar__navLink--title nav-link"
                               href="/index.html"
                            >
                                <i class="fa fa-dot-circle-o" aria-hidden="true"></i>
                                First Steps
                            </a>
                        </li>

                        <li class="c-sidebar__navItem nav-item">
                            <a class="c-sidebar__navLink c-sidebar__navLink--title nav-link"
                               href="/api-reference.html"
                            >
                                <i class="fa fa-barcode" aria-hidden="true"></i>
                                API Reference
                            </a>
                        </li>

                            <ul class="c-sidebar__nav c-sidebar__nav--sub-1 nav nav-pills flex-column">
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/api-reference/model.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            Model
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/api-reference/application-api.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            Application API
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/api-reference/search-api.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            Search API
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/api-reference/interaction.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            Interaction API
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/api-reference/events.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            Events API
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/api-reference/events.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            Logs API
                                        </a>
                                    </li>
                            </ul>
                        <li class="c-sidebar__navItem nav-item">
                            <a class="c-sidebar__navLink c-sidebar__navLink--title nav-link"
                               href="/api-client.html"
                            >
                                <i class="fa fa-code" aria-hidden="true"></i>
                                API Client
                            </a>
                        </li>

                            <ul class="c-sidebar__nav c-sidebar__nav--sub-1 nav nav-pills flex-column">
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/api-client/model.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            Model
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/api-client/query.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            Query
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/api-client/result.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            Result
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/api-client/repository.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            Repository
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/api-client/event.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            Event
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/api-client/config.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            Config
                                        </a>
                                    </li>
                            </ul>
                        <li class="c-sidebar__navItem nav-item">
                            <a class="c-sidebar__navLink c-sidebar__navLink--title nav-link"
                               href="/plugins.html"
                            >
                                <i class="fa fa-plug" aria-hidden="true"></i>
                                Plugins
                            </a>
                        </li>

                            <ul class="c-sidebar__nav c-sidebar__nav--sub-1 nav nav-pills flex-column">
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/plugins/callbacks.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            Callback Plugin
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/plugins/metadata-fields.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            Metadata Fields Plugin
                                        </a>
                                    </li>
                            </ul>
                        <li class="c-sidebar__navItem nav-item">
                            <a class="c-sidebar__navLink c-sidebar__navLink--title nav-link"
                               href="/ui.html"
                            >
                                <i class="fa fa-search" aria-hidden="true"></i>
                                UI
                            </a>
                        </li>

                            <ul class="c-sidebar__nav c-sidebar__nav--sub-1 nav nav-pills flex-column">
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/ui/search-ui.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            Search UI
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/ui/autocomplete-ui.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            Autocomplete UI
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/ui/events-ui.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            Events UI
                                        </a>
                                    </li>
                            </ul>
                        <li class="c-sidebar__navItem nav-item">
                            <a class="c-sidebar__navLink c-sidebar__navLink--title nav-link"
                               href="/integrations.html"
                            >
                                <i class="fa fa-chain" aria-hidden="true"></i>
                                Integrations
                            </a>
                        </li>

                            <ul class="c-sidebar__nav c-sidebar__nav--sub-1 nav nav-pills flex-column">
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/integrations/symfony-bundle.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            Symfony Bundle
                                        </a>
                                    </li>
                            </ul>
                        <li class="c-sidebar__navItem nav-item">
                            <a class="c-sidebar__navLink c-sidebar__navLink--title nav-link"
                               href="/recipes.html"
                            >
                                <i class="fa fa-ticket" aria-hidden="true"></i>
                                Recipes
                            </a>
                        </li>

                            <ul class="c-sidebar__nav c-sidebar__nav--sub-1 nav nav-pills flex-column">
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/recipes/creating-a-transformer.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            Creating a Transformer
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/recipes/working-with-relations.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            Working with relations
                                        </a>
                                    </li>
                            </ul>
                        <li class="c-sidebar__navItem nav-item">
                            <a class="c-sidebar__navLink c-sidebar__navLink--title nav-link"
                               href="/faqs.html"
                            >
                                <i class="fa fa-question" aria-hidden="true"></i>
                                FAQs
                            </a>
                        </li>

                            <ul class="c-sidebar__nav c-sidebar__nav--sub-1 nav nav-pills flex-column">
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/faqs/project.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            FAQS about the project
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/faqs/admin.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            FAQS about the admin
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/faqs/clients.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            FAQS about the clients
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/faqs/ui.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            FAQS about the UI
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/faqs/integrations.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            FAQS about the integrations
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/faqs/docs.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            FAQS about the docs
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/faqs/us.html"
                                        >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                            FAQS about us
                                        </a>
                                    </li>
                            </ul>
                </ul>
            </div>            <!-- Sidebar -->

            <!-- Main -->
            <main class="col-sm-8 col-md-9 col-lg-10 ml-sm-auto pt-3" role="main">
                <section class="c-content">
                    <!-- Content -->
                    <h1 id="plugins"><a name="plugins" class="fa fa-link" href="#"></a>Plugins</h1>
<p>Do you know how you can make your own Apisearch instance much more amazing that
it is by default? By using Apisearch Plugins you can expand as much as you want
the software by only following some simple instructions.</p>
<p>You will find some base plugins in the main server repository, and some other
official plugins developed by our partners.</p>
<h2 id="metadata-fieldspluginsmetadata-fieldshtml"><a name="metadata-fieldspluginsmetadata-fieldshtml" class="fa fa-link" href="#"></a><a href="plugins/metadata-fields.html">Metadata Fields</a></h2>
<p>Save your read-only fields in a key-value technology instead of storing it
inside your search infrastructure. Populate your items with these values
depending on your needs every moment.</p>
<ul>
<li>Source - <a href="https://github.com/apisearch-io/search-server/tree/master/Plugin/MetadataFields">Github</a></li>
<li>Current versions - <a href="https://github.com/apisearch-io/search-server/releases">0.1.*</a></li>
</ul>
<h2 id="callbackspluginscallbackshtml"><a name="callbackspluginscallbackshtml" class="fa fa-link" href="#"></a><a href="plugins/callbacks.html">Callbacks</a></h2>
<p>Make additional callbacks before or after your calls. By doing them before you
will be able to modify the input data, and by doing them after, you will be able
to change the result value.</p>
<ul>
<li>Source - <a href="https://github.com/apisearch-io/search-server/tree/master/Plugin/Callbacks">Github</a></li>
<li>Current versions - <a href="https://github.com/apisearch-io/search-server/releases">0.1.*</a></li>
</ul>
<h2 id="make-your-own-plugin"><a name="make-your-own-plugin" class="fa fa-link" href="#"></a>Make your own plugin</h2>
<p>Apisearch is implemented by doing <a href="https://www.martinfowler.com/bliki/CQRS.html">CQRS</a>.
This means that each time anyone uses Apisearch, a new command is created as a
Value Object. This value should not be changed by anyone during it’s life. This
objects is taken by one and only one handler, and some actions are done by this
handler.</p>
<p>For example.</p>
<p>You make a query. Inside the controller, the more external layer of the
application, we create a ValueObject called <code>Query</code> and we add this object into
an engine called Command Bus. This bus is like a tube, with an start and a
finale. Inside our controller we have the start, and the handler would be the
finale of the tube.</p>
<p>The magic part of this tube is that, between the start and the finale, we have
several (as many as we want) holes, where we can intercept all the Commands that
we want, read them and even change them.</p>
<blockquote>
<p>By default, the CQRS pattern would say that the command should’nt be
changeable, but by adding this new plugins layer, some commands can be
replaced by new ValueObjects of the same class.</p>
</blockquote>
<blockquote>
<p>The project uses a specific CQRS pattern implementation, and is not to be a
perfect pattern implementation project.</p>
</blockquote>
<p>And there’s where Apisearch Plugins take their effect. A plugin can basically
change the behavior of all actions by creating Middlewares. Let’s see an example
of a Plugin with one mission. Each time a query is done, we want to add a new
Filter that would allow us to only serve those items inside a group. For
example, very useful for adding an extra layer of security.</p>
<h2 id="creating-the-plugin-base"><a name="creating-the-plugin-base" class="fa fa-link" href="#"></a>Creating the plugin base</h2>
<p>An Apisearch, by default, is a Symfony plugin. You can see some examples of how
these plugins are designed in our default set of Plugins, but let’s talk about
a simple bundle architecture</p>
<pre><code>plugin/
|<span class="hljs-string">
</span>|<span class="hljs-string">-- DependencyInjection/
</span>|<span class="hljs-string">    </span>|<span class="hljs-string">-- CompilerPass/ ..
     </span>|<span class="hljs-string">-- MyPluginExtension.php
     </span>|<span class="hljs-string">-- MyPluginConfiguration.php
</span>|<span class="hljs-string">-- Domain
</span>|<span class="hljs-string">    </span>|<span class="hljs-string">-- Model/ ..
</span>|<span class="hljs-string">    </span>|<span class="hljs-string">-- Middleware/
</span>|<span class="hljs-string">         </span>|<span class="hljs-string">-- QueryMiddleware.php
</span>|<span class="hljs-string">         </span>|<span class="hljs-string">-- IndexItemsMiddleware.php
</span>|<span class="hljs-string">         </span>|<span class="hljs-string">-- DeleteItemsMiddleware.php
</span>|<span class="hljs-string">    </span>|<span class="hljs-string">-- Repository/
</span>|<span class="hljs-string">         </span>|<span class="hljs-string">-- MyRepository.php
</span>|<span class="hljs-string">         </span>|<span class="hljs-string">-- MyInMemoryRepository.php
</span>|<span class="hljs-string">-- Resources/ ..
</span>|<span class="hljs-string">-- Redis/
</span>|<span class="hljs-string">    </span>|<span class="hljs-string">-- MyRedisRepository.php
</span>|<span class="hljs-string">-- MyPluginBundle.php
</span></code></pre>
<p>As you can see, anything different than other simple bundles inside the Symfony
environment.</p>
<p>The difference between a simple Bundle and a Apisearch plugin is an interface.
As simple as it sounds.</p>
<pre><code class="language-php"><span class="hljs-comment">/**
 * Class CallbacksPluginBundle.
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CallbacksPluginBundle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseBundle</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Plugin</span>
</span>{
    <span class="hljs-comment">/**
     * Get plugin name.
     *
     * <span class="hljs-doctag">@return</span> string
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPluginName</span><span class="hljs-params">()</span>: <span class="hljs-title">string</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">'callbacks'</span>;
    }
}
</code></pre>
<p>The method that any plugin must implement is the <code>getPluginName</code>. It will be
used mainly for enabling desired plugins when using an specific token. For
example, this one we’re building now, we could configure some tokens where this
filter will be applied by enabling this plugin. But we could have other regular
tokens with all plugins disabled.</p>
<h2 id="enabling-the-plugin"><a name="enabling-the-plugin" class="fa fa-link" href="#"></a>Enabling the plugin</h2>
<p>Of course, we need to enable the plugin. Again, same strategy that is used
inside Symfony environment. Enable the Bundle in our kernel.</p>
<pre><code class="language-yml"><span class="hljs-attr">bundles:</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">Apisearch\Server\ApisearchServerBundle</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">Apisearch\Plugin\Callbacks\CallbacksPluginBundle</span>
</code></pre>
<h2 id="creating-a-middleware"><a name="creating-a-middleware" class="fa fa-link" href="#"></a>Creating a Middleware</h2>
<p>Let’s add some action in our plugin. And to do that, we are going to create a
new middleware called <code>QueryMiddleware</code>. We’re going to configure the middleware
in order to make some action <strong>ONLY</strong> when a new Query is done and the command
<code>Query</code> is passed through the command bus.</p>
<pre><code class="language-php"><span class="hljs-comment">/**
 * Class QueryApplySomeFiltersMiddleware.
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QueryApplySomeFiltersMiddleware</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">PluginMiddleware</span>
</span>{
    <span class="hljs-comment">/**
     * Execute middleware.
     *
     * <span class="hljs-doctag">@param</span> CommandWithRepositoryReferenceAndToken $command
     * <span class="hljs-doctag">@param</span> callable                               $next
     *
     * <span class="hljs-doctag">@return</span> mixed
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">execute</span><span class="hljs-params">(
        CommandWithRepositoryReferenceAndToken $command,
        $next
    )</span> </span>{
        <span class="hljs-comment">// Do some action before the Command handler is executed. We would place</span>
        <span class="hljs-comment">// the filters here</span>
        
        $result = $next($command);

        <span class="hljs-comment">// Do some action after the Command handler is executed, and before the</span>
        <span class="hljs-comment">// value is returned to the previous middleware</span>

        <span class="hljs-keyword">return</span> $result;
    }

    <span class="hljs-comment">/**
     * Events subscribed namespace.
     *
     * <span class="hljs-doctag">@return</span> string[]
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSubscribedEvents</span><span class="hljs-params">()</span>: <span class="hljs-title">array</span>
    </span>{
        <span class="hljs-keyword">return</span> [Query::class];
    }
}
</code></pre>
<p>As you can see, the method <code>getSubscribedEvents</code> allow us to work with different
commands in the same class. But remember that different actions related to
different commands should be placed in several middleware classes.</p>
<p>After defined our class, we need to create the middleware service and tell
Apisearch that this is a middleware that should be executed inside a plugin. For
such action, let’s create a service definition with the tag
<code>apisearch_plugin.middleware</code>.</p>
<pre><code class="language-yml"><span class="hljs-attr">services:</span>

    <span class="hljs-comment">#</span>
    <span class="hljs-comment"># Middlewares</span>
    <span class="hljs-comment">#</span>
    <span class="hljs-string">apisearch_plugin.my_plugin.query_apply_some_filters:</span>
<span class="hljs-attr">        class:</span> <span class="hljs-string">Apisearch\Plugin\MetadataFields\Domain\Middleware\IndexItemsMiddleware</span>
<span class="hljs-attr">        arguments:</span>
<span class="hljs-bullet">            -</span> <span class="hljs-string">"@apisearch_plugin.metadata_fields.repository"</span>
<span class="hljs-attr">        tags:</span>
<span class="hljs-bullet">            -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-string">apisearch_plugin.middleware</span> <span class="hljs-string">}</span>
</code></pre>
<blockquote>
<p>Apisearch will not ensure you the order between middleware classes, so you
should only work with main Apisearch specification, and never have a hard
dependency with other plugins.</p>
</blockquote>
<h2 id="apisearch-commands-and-queries"><a name="apisearch-commands-and-queries" class="fa fa-link" href="#"></a>Apisearch Commands and Queries</h2>
<p>But what is a Command and a Query? And the most important question, what
Commands and Queries can we find here in Apisearch? This project uses</p>
<p>A Command is this Value Object that we generate in all these first layers that
we can find around Apisearch. For example, the first layer when we come from the
HTTP layer is called Controller, and the first layer when we come from the
console is called command. A Command is like an imperative action, and should
follow the same format always, no matter the interface we’re using, for example.</p>
<p>So, the difference between a Command and a Query? Well, a Command is an action
that will change the internal status of the application, a write operation. The
status before and after applying this command could be barely different.</p>
<p>And can a Command have a response? Not at all. Only changes the state, and
because this operation could be asynchronous, we must assume that we will not
receive any response.</p>
<p>So, the question is, how can we retrieve information from Apisearch? Well, by
using Queries. A Query is a type of Command that instead of changing the status
of the application, only gets information from it and returns it.</p>
<ul>
<li>So, if I need to make a change into Apisearch and return it’s new value, can
I do it by using Commands?</li>
<li>Nopes. You can’t. A single action means a single action, and this can be a
write action, what could be executed asynchronously sometime from a queue, or a
read action, which in this case you would return the value instantly.</li>
</ul>
<h2 id="commands"><a name="commands" class="fa fa-link" href="#"></a>Commands</h2>
<p>This is the main list of Apisaerch Commands. As you will see, all these actions
could be applied by using a queue, in an asynchronous way, and don’t really need
to return any value.</p>
<blockquote>
<p>Some of these Commands application action is reduced to an specific app_id,
an index, and always previous verification of a valid token.</p>
</blockquote>
<ul>
<li>AddInteraction - A new interaction has been inserted in the system</li>
<li>AddToken - Adds a new token</li>
<li>ConfigureIndex - Configures an existing and previously created index. This
action may require to stop the index some time</li>
<li>CreateIndex - Creates a new index</li>
<li>DeleteAllInteractions - Deletes all available interactions</li>
<li>DeleteIndex - Deletes an existing index</li>
<li>DeleteItems - Deletes a set of Items defined by their identifiers</li>
<li>DeleteToken - Deletes an existing token</li>
<li>DeleteTokens - Deletes all existing tokens</li>
<li>IndexItems - Indexes a set of items.</li>
<li>ResetIndex - Resets the index. Removed all existing information.</li>
<li>UpdateItems - Applies some updates over the existing items</li>
</ul>
<h2 id="queries"><a name="queries" class="fa fa-link" href="#"></a>Queries</h2>
<p>This is the main list of Apisearch Queries. As you will see, all these actions
don’t change the status of the application, and only ask for some information
from inside the system</p>
<blockquote>
<p>Some of these Query application action is reduced to an specific app_id,
an index, and always previous verification of a valid token.</p>
</blockquote>
<ul>
<li>CheckHealth - Checks the cluster health</li>
<li>CheckIndex - Checks if an index is available</li>
<li>GetTokens - Return all the existing tokens</li>
<li>Ping - Makes a simple ping</li>
<li>Query - Makes a query over all the existing Items</li>
<li>QueryEvents - Makes a query over all generated events</li>
<li>QueryLogs - Makes a query over all generated logs</li>
</ul>
<h2 id="events-in-apisearch"><a name="events-in-apisearch" class="fa fa-link" href="#"></a>Events in Apisearch</h2>
<p>By using Middlewares what we do is to change the compositions of the Commands
themselves or the results that the associated handlers produce. But this is only
one part of the Plugins environment. What happens if we want to add an specific
action when Items are indexed in the system? Here some options for you.</p>
<ul>
<li>Add a middleware before these items are really indexed, and pray for not to
have an exception. Otherwise you’ll have inconsistent data.</li>
<li>Add a middleware after these items are really indexed, but this point is
specially designed for response manipulation. What if this action creates
several related actions, and you need one of them? For sure, you’ll not be able
to access to this data</li>
</ul>
<p>In order to take some actions at the same moment these happen, we introduce you
the Apisearch Domain Events. These are specially created to make sure you have
all needed information of what happen inside the project. And Event Subscribers
are the right way of subscribing to these events.</p>
<blockquote>
<p>If you define Apisearch to consume events, instead of a default inline mode,
in an asynchronous way, you will not recieve these events once they happen,
but when they are taken from the queue</p>
</blockquote>
<h2 id="creating-an-event-subscriber"><a name="creating-an-event-subscriber" class="fa fa-link" href="#"></a>Creating an Event Subscriber</h2>
<p>Let’s see a simple event subscriber implementation.</p>
<pre><code class="language-php"><span class="hljs-comment">/**
 * Class MyEventSubscriber.
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyEventSubscriber</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">EventSubscriber</span>
</span>{
    <span class="hljs-comment">/**
     * Subscriber should handle event.
     *
     * <span class="hljs-doctag">@param</span> DomainEventWithRepositoryReference $domainEventWithRepositoryReference
     *
     * <span class="hljs-doctag">@return</span> bool
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">shouldHandleEvent</span><span class="hljs-params">(DomainEventWithRepositoryReference $domainEventWithRepositoryReference)</span>: <span class="hljs-title">bool</span>
    </span>{
        <span class="hljs-keyword">return</span> Query::class;
    }

    <span class="hljs-comment">/**
     * Handle event.
     *
     * <span class="hljs-doctag">@param</span> DomainEventWithRepositoryReference $domainEventWithRepositoryReference
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span><span class="hljs-params">(DomainEventWithRepositoryReference $domainEventWithRepositoryReference)</span>
    </span>{
        <span class="hljs-comment">// Do something when a new Query is handled by Apisearch</span>
        
        $repositoryReference = $domainEventWithRepositoryReference-&gt;getRepositoryReference();
        $domainEvent = $domainEventWithRepositoryReference-&gt;getDomainEvent();
    }
}
</code></pre>
<p>The first method would return if, given a Domain Event, the subscribe is valid.
One Domain Event, one subscriber. That will help us the split between files all
our domain logic.</p>
<p>After we created the class, we need to publish it as an event subscriber.</p>
<pre><code class="language-yml"><span class="hljs-attr">services:</span>
<span class="hljs-attr">    my_service:</span>
<span class="hljs-attr">        class:</span> <span class="hljs-string">My\Event\Subscriber</span>
<span class="hljs-attr">        tags:</span>
<span class="hljs-bullet">            -</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-string">apisearch_server.domain_event_subscriber</span> <span class="hljs-string">}</span>
</code></pre>
<h2 id="domain-events"><a name="domain-events" class="fa fa-link" href="#"></a>Domain Events</h2>
<p>These are the available Domain Events inside Apisearch.</p>
<ul>
<li>IndexWasConfigured - An existing Index has been configured</li>
<li>IndexWasReset - Index has been reset and all Items inside were removed</li>
<li>InteractionWasAdded - A new interaction has been added</li>
<li>ItemsWereDeleted - Some items have been deleted from the engine</li>
<li>ItemsWereAdded - Some items have been added in the engine</li>
<li>ItemsWereUpdated - Some items have been updated</li>
<li>QueryWasMade - A new Query has been done</li>
<li>TokensWereDeleted - All tokens were deleted</li>
<li>TokenWasAdded - A new token has been added</li>
<li>TokenWasDeleted - An existing token was deleted</li>
</ul>

                    <!-- /Content -->

                    <hr>
                    <a class="c-content__editOnGithub"
                       target="_blank"
                       href="https://github.com/apisearch-io/docs/tree/source/src/content/plugins.md">
                        <i class="fa fa-github" aria-hidden="true"></i>
                        Edit this page!
                    </a>
                </section>
            </main>
            <!-- /Main -->

            <!-- Footer -->
            <footer class="c-footer col-sm-9 ml-sm-auto col-md-10 pt-3">
                <nav class="navbar">
                    <span class="c-footer__logoWrapper navbar-text text-center d-block">
                        <img src="https://raw.githubusercontent.com/apisearch-io/apisearch.io/master/assets/media/apisearch-long-logo.png"
                             height="16"
                             class="c-footer__logo c-footer__logo--bottom d-block align-top"
                             alt="Logo Apisearch"
                        >
                    </span>
                    <ul class="c-footer__linksWrapper navbar-nav">
                        <li class="c-footer__linkItem nav-item">
                            <a href="https://github.com/apisearch-io"
                               target="_blank"
                               class="c-footer__link c-footer__link--icon nav-link"
                            >
                                <i class="fa fa-github" aria-hidden="true"></i>
                            </a>
                        </li>
                        <li class="c-footer__linkItem nav-item">
                            <a href="https://www.linkedin.com/company/18418235"
                               target="_blank"
                               class="c-footer__link c-footer__link--icon nav-link"
                            >
                                <i class="fa fa-linkedin" aria-hidden="true"></i>
                            </a>
                        </li>
                        <li class="c-footer__linkItem nav-item">
                            <a href="https://twitter.com/apisearch_io"
                               target="_blank"
                               class="c-footer__link c-footer__link--icon nav-link"
                            >
                                <i class="fa fa-twitter" aria-hidden="true"></i>
                            </a>
                        </li>
                        <li class="c-footer__linkItem nav-item">
                            <a href="https://www.instagram.com/apisearch"
                               target="_blank"
                               class="c-footer__link c-footer__link--icon nav-link"
                            >
                                <i class="fa fa-instagram" aria-hidden="true"></i>
                            </a>
                        </li>
                        <li class="c-footer__linkItem nav-item">
                            <a href="https://apisearch.slack.com"
                               target="_blank"
                               class="c-footer__link c-footer__link--icon nav-link"
                            >
                                <i class="fa fa-commenting" aria-hidden="true"></i>
                            </a>
                        </li>
                    </ul>
                    <ul class="c-footer__linksWrapper navbar-nav">
                        <li class="c-footer__linkItem nav-item">
                            <a href="http://apisearch.io"
                               class="c-footer__link nav-link"
                            >
                                Home
                            </a>
                        </li>
                        <li class="c-footer__linkItem nav-item">
                            <a href="http://docs.apisearch.io"
                               class="c-footer__link nav-link"
                            >
                                Docs
                            </a>
                        </li>
                        <li class="c-footer__linkItem nav-item">
                            <a href="mailto:hello+docs@puntmig.com"
                               class="c-footer__link nav-link"
                            >
                                Contact
                            </a>
                        </li>
                        <li class="c-footer__linkItem nav-item">
                            <a href="https://www.linkedin.com/company/puntmig/"
                               class="c-footer__link nav-link"
                            >
                                Linkedin
                            </a>
                        </li>
                        <li class="c-footer__linkItem nav-item">
                            <a href="#terms-and-conditions"
                               class="c-footer__link nav-link"
                            >
                                Terms & Conditions
                            </a>
                        </li>
                    </ul>
                </nav>
            </footer>            <!-- /Footer -->
        </div>
    </div>
    <!-- /Main -->

    <!-- Go up -->
    <a id="goUpButton"
       class="c-goUp d-none fa fa-angle-up"
       href="#"
       aria-hidden="true"
    ></a>
    <!-- /Go up -->

    <!-- Scripts -->
    <script src="./assets/js/app.js"></script>
</body>
</html>